import { AnchoreService } from "./AnchoreService";
import { VulnScanItem } from "../models/VulnerabilityScanItemResult";
import { TaskInput } from "../TaskInput";
import { VulnSeverity } from "../enum";
import { VulnScanHtmlExporter } from "../exporters/VulnScanHtmlExporter";

export class VulnerabilityScanService {
    private vulnerabilityScanResultItems: VulnScanItem[];

    constructor(
        private anchoreService: AnchoreService
    ) {
        this.vulnerabilityScanResultItems = [];
    }

    executeVulnerabilityScan(imageName: string): void {
        this.vulnerabilityScanResultItems = this.anchoreService.getAllImageVulnerabilities(TaskInput.getImageName());
    }

    getCount(severity: VulnSeverity): Number {
        var results: VulnScanItem[] = this.vulnerabilityScanResultItems.filter((x) => {
            return x.severity === severity;
        });

        return results.length;
    }

    saveHtmlReport(filePath: string): void {
        var exporter = new VulnScanHtmlExporter(this.vulnerabilityScanResultItems);
        exporter.saveFile(filePath);
    }
}